{% extends "base.html" %}

{% block title %}Meu Perfil - E-commerce{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0"><i class="fas fa-user"></i> Meu Perfil</h4>
        </div>

        <div class="card-body">
          <!-- Avatar e nome -->
          <div class="row mb-4">
            <div class="col-md-12 text-center">
              <div class="profile-avatar mb-3">
                <i class="fas fa-user-circle fa-5x text-secondary"></i>
              </div>
              <h5 class="text-primary">{{ usuario.nome }}</h5>
              <p class="text-muted">
                <i class="fas fa-calendar-alt"></i>
                Membro desde {{ usuario.data_cadastro|datetime('%d/%m/%Y') }}
              </p>
            </div>
          </div>

          <div class="row">
            <!-- Informações Pessoais -->
            <div class="col-md-6">
              <div class="card border-start border-4 border-primary shadow-sm mb-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="fw-bold text-uppercase text-primary small">Informações Pessoais</div>
                    <i class="fas fa-id-card fa-2x text-body-secondary"></i>
                  </div>

                  <div class="mt-3">
                    <p><strong>Nome:</strong> {{ usuario.nome }}</p>
                    <p><strong>Email:</strong> {{ usuario.email }}</p>
                    <p><strong>Telefone:</strong>
                      {{ usuario.telefone if usuario.telefone else '<span class="text-muted">Não informado</span>'|safe }}
                    </p>
                    <p><strong>Endereço:</strong><br>
                      {{ usuario.endereco if usuario.endereco else '<span class="text-muted">Não informado</span>'|safe }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Estatísticas -->
            <div class="col-md-6">
              <div class="card border-start border-4 border-success shadow-sm mb-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="fw-bold text-uppercase text-success small">Estatísticas</div>
                    <i class="fas fa-chart-bar fa-2x text-body-secondary"></i>
                  </div>

                  <div class="mt-3">
                    <p><strong>Anúncios Publicados:</strong>
                      <span class="badge bg-primary">{{ usuario.anuncios|length }}</span>
                    </p>
                    <p><strong>Anúncios Ativos:</strong>
                      <span class="badge bg-success">{{ usuario.anuncios|selectattr('ativo')|list|length }}</span>
                    </p>
                    <p><strong>Compras Realizadas:</strong>
                      <span class="badge bg-info text-dark">{{ usuario.compras|length }}</span>
                    </p>
                    <p><strong>Vendas Realizadas:</strong>
                      <span class="badge bg-warning text-dark">{{ usuario.vendas|length }}</span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Ações do Perfil -->
          <div class="row">
            <div class="col-md-12">
              <div class="card border-start border-4 border-info shadow-sm">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="fw-bold text-uppercase text-info small">Ações do Perfil</div>
                    <i class="fas fa-cogs fa-2x text-body-secondary"></i>
                  </div>

                  <div class="mt-3">
                    <div class="btn-group-vertical w-100" role="group">
                      <a href="{{ url_for('editar_perfil') }}" class="btn btn-outline-primary mb-2">
                        <i class="fas fa-edit"></i> Editar Perfil
                      </a>
                      <a href="{{ url_for('meus_anuncios') }}" class="btn btn-outline-success mb-2">
                        <i class="fas fa-bullhorn"></i> Meus Anúncios
                      </a>
                      <a href="{{ url_for('minhas_compras') }}" class="btn btn-outline-info mb-2">
                        <i class="fas fa-shopping-cart"></i> Minhas Compras
                      </a>
                      <a href="{{ url_for('minhas_vendas') }}" class="btn btn-outline-warning mb-2">
                        <i class="fas fa-dollar-sign"></i> Minhas Vendas
                      </a>
                      <a href="{{ url_for('meus_favoritos') }}" class="btn btn-outline-secondary mb-2">
                        <i class="fas fa-heart"></i> Meus Favoritos
                      </a>
                      <a href="{{ url_for('minhas_perguntas') }}" class="btn btn-outline-dark mb-2">
                        <i class="fas fa-question-circle"></i> Minhas Perguntas
                      </a>
                      <a href="{{ url_for('perguntas_recebidas') }}" class="btn btn-outline-primary mb-2 d-flex align-items-center justify-content-between">
                        <span><i class="fas fa-inbox"></i> Perguntas Recebidas</span>
                        {% set unread_count = count_unread_questions() %}
                        {% if unread_count > 0 %}
                          <span class="badge bg-danger ms-2">{{ unread_count }}</span>
                        {% endif %}
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Relatórios -->
          <div class="row mt-4">
            <div class="col-md-12 text-center">
              <div class="btn-group" role="group">
                <a href="{{ url_for('relatorio_compras') }}" class="btn btn-outline-info">
                  <i class="fas fa-chart-line"></i> Relatório de Compras
                </a>
                <a href="{{ url_for('relatorio_vendas') }}" class="btn btn-outline-success">
                  <i class="fas fa-chart-pie"></i> Relatório de Vendas
                </a>
              </div>
            </div>
          </div>

          <hr class="mt-4">

          <!-- Status da Conta -->
          <div class="row">
            <div class="col-md-12 text-center">
              <small class="text-muted">
                <strong>Status da Conta:</strong>
                {% if usuario.ativo %}
                  <span class="badge bg-success">Ativa</span>
                {% else %}
                  <span class="badge bg-danger">Inativa</span>
                {% endif %}
              </small>
            </div>
          </div>

          <!-- Botão Desativar Conta -->
          <div class="row mt-3">
            <div class="col-md-12 text-center">
              <a href="{{ url_for('desativar_conta') }}" class="btn btn-outline-danger btn-sm">
                <i class="fas fa-user-times"></i> Desativar Conta
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.profile-avatar {
  margin-bottom: 1rem;
}
.card {
  transition: all 0.3s;
}
.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1) !important;
}
.btn-group-vertical .btn {
  text-align: left;
}
</style>
{% endblock %}
